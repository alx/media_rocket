<div id="upload_button">Upload</div>

<p>Uploaded files:</p>
<ol class="files"/>

<script type="text/javascript" charset="utf-8">

	$(document).ready(function(){
		
		new Ajax_upload('#upload_button',{
			
			action: '<%= slice_url(:upload) %>',
			name: 'media',
			data: {
				<% unless @category.nil? %>
	    		category : '<%= @category.name %>',
				<% end %>
		    	site : '<%= @site.name %>'
		  	},
			onSubmit : function(file, ext){
				// change button text, when user selects file			
				button.text('Uploading');

				// If you want to allow uploading only 1 file at time,
				// you can disable upload button
				this.disable();

				// Uploding -> Uploading. -> Uploading...
				interval = window.setInterval(function(){
					var text = button.text();
					if (text.length < 13){
						button.text(text + '.');					
					} else {
						button.text('Uploading');				
					}
				}, 200);
			},
			onComplete: function(file, response){
				button.text('Upload');

				window.clearInterval(interval);

				// enable upload button
				this.enable();

				// add file to the list
				$('<li></li>').appendTo('#example1 .files').text(file);						
			}
		});
		
	});
	
</script>