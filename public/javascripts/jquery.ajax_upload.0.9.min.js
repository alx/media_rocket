(function(B){if(!B){return }var A=function(){var C=0;return function(){return C++}}();window.Ajax_upload=function(D,C){D=B(D);if(D.size()!=1){console.error("You passed ",D.size()," elements to ajax_upload at once");return false}this.button=D;this.wrapper=null;this.form=null;this.input=null;this.iframe=null;this.disabled=false;this.submitting=false;this.settings={action:"upload.php",name:"userfile",data:{},onSubmit:function(E,F){},onComplete:function(F,E){}};B.extend(this.settings,C);this.create_wrapper();this.create_input();if(jQuery.browser.msie){this.make_parent_opaque()}this.create_iframe()};Ajax_upload.prototype={set_data:function(C){this.settings.data=C},disable:function(){this.disabled=true;if(!this.submitting){this.input.attr("disabled",true);this.button.removeClass("hover")}},enable:function(){this.disabled=false;this.input.attr("disabled",false)},create_wrapper:function(){var D=this.button,E;E=this.wrapper=B("<div></div>").insertAfter(D).append(D);setTimeout(function(){E.css({position:"relative",display:"block",overflow:"hidden",height:D.outerHeight(true),width:D.outerWidth(true)})},1);var C=this;E.mousemove(function(F){if(!C.input){return }C.input.css({top:F.pageY-E.offset().top-5+"px",left:F.pageX-E.offset().left-170+"px"})})},create_input:function(){var C=this;this.input=B('<input type="file" />').attr("name",this.settings.name).css({position:"absolute",margin:0,padding:0,width:"220px",height:"10px",opacity:0}).change(function(){if(B(this).val()==""){return }C.submitting=true;C.submit();if(C.disabled){C.disable()}C.submitting=false}).appendTo(this.wrapper).hover(function(){C.button.addClass("hover")},function(){C.button.removeClass("hover")});if(this.disabled){this.input.attr("disabled",true)}},create_iframe:function(){var C="valums97hhu"+A();this.iframe=B('<iframe id="'+C+'" name="'+C+'"></iframe>').css("display","none").appendTo("body")},submit:function(){var C=this,F=this.settings;var D=this.file_from_path(this.input.val());if(F.onSubmit.call(this,D,this.get_ext(D))===false){return }this.create_form();this.input.appendTo(this.form);this.form.submit();this.input.remove();this.input=null;this.form.remove();this.form=null;this.submitting=false;this.create_input();var E=this.iframe;E.load(function(){var G=E.contents().find("body").html();F.onComplete.call(C,D,G);setTimeout(function(){E.remove()},1)});this.create_iframe()},create_form:function(){this.form=B('<form method="post" enctype="multipart/form-data"></form>').attr({action:this.settings.action,target:this.iframe.attr("name")}).appendTo("body");for(var C in this.settings.data){B('<input type="hidden" />').appendTo(this.form).attr({name:C,value:this.settings.data[C]})}},file_from_path:function(C){return C.replace(/.*(\/|\\)/,"")},get_ext:function(C){return(/[.]/.exec(C))?/[^.]+$/.exec(C.toLowerCase()):""},make_parent_opaque:function(){this.button.add(this.button.parents()).each(function(){var C=B(this).css("backgroundColor");var D=B(this).css("backgroundImage");if(C!="transparent"||D!="none"){B(this).css("opacity",1);return false}})}}})(jQuery);